# https://moonrepo.dev/docs/config/tasks
$schema: 'https://moonrepo.dev/schemas/tasks.json'

workspace:
  inheritedTasks:
    exclude: ['build', 'compile', 'release', 'test']

tasks:
  dev:
    command: email preview fixtures/templates
    options:
      cache: false
      outputStyle: 'stream'

  install:
    command: playwright install --with-deps
    options:
      cache: false
      outputStyle: 'stream'

  run:
    command: playwright test -x
    deps:
      - ~:install
      - ~:setup
    env:
      SMOKE_V2_STATE_PATH: /tmp/jsx-email-smoke-v2.state
    options:
      cache: false
      outputStyle: 'stream'
      runDepsInParallel: false

  run.ci:
    command: playwright test -x
    deps:
      - ~:install
      - ~:setup.ci
    env:
      DOT_LOG_LEVEL: debug
      LOCAL_SMOKE: 'true'
      SMOKE_V2_STATE_PATH: /tmp/jsx-email-smoke-v2.state
    options:
      cache: false
      outputStyle: 'stream'
      runDepsInParallel: false

  setup:
    command: ./scripts/ci-preview-setup-smoke-v2.sh
    env:
      SMOKE_V2_STATE_PATH: /tmp/jsx-email-smoke-v2.state
    options:
      cache: false
      outputStyle: 'stream'
      runFromWorkspaceRoot: true
    platform: system

  setup.ci:
    command: ./scripts/ci-preview-setup-smoke-v2.sh
    env:
      SMOKE_V2_STATE_PATH: /tmp/jsx-email-smoke-v2.state
    options:
      cache: false
      outputStyle: 'stream'
      runFromWorkspaceRoot: true
    platform: system

  start.ci:
    command: ./scripts/ci-preview-start-smoke-v2.sh
    env:
      SMOKE_V2_STATE_PATH: /tmp/jsx-email-smoke-v2.state
    options:
      cache: false
      outputStyle: 'stream'
      runFromWorkspaceRoot: true
    platform: system
