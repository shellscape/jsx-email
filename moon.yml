# https://moonrepo.dev/docs/config/tasks
$schema: 'https://moonrepo.dev/schemas/tasks.json'

workspace:
  inheritedTasks:
    exclude: ['build', 'compile', 'release', 'tsconfig.link', 'test']

tasks:
  build.packages.first: &build # command: echo "✓ All packages compiled"
    deps:
      - body:compile
      - button:compile
      - column:compile
      - container:compile
      - font:compile
      - head:compile
      - heading:compile
      - hr:compile
      - html:compile
      - img:compile
      - link:compile
      - markdown:compile
      - preview:compile
      - row:compile
      - section:compile
      - text:compile
      - create-jsx-email:compile
      - render:compile
      - tailwind:compile
    options:
      cache: false
      outputStyle: 'stream'
      runDepsInParallel: false

  build.packages.second:
    <<: *build
    deps:
      - build.packages.first

  build.packages.third:
    <<: *build
    deps:
      - build.packages.second
      - all:compile

  build.packages.fourth:
    <<: *build
    deps:
      - build.packages.third
      - cli:compile

  build.packages:
    <<: *build
    deps:
      - build.packages.fourth

  lint:
    deps:
      - jsx-email:lint.docs
      - jsx-email:lint.json
      - jsx-email:lint.package
      - jsx-email:lint.js
    options:
      cache: false

  lint.docs:
    command: 'prettier --write .github/**/*.md **/README.md docs/**/*.md'
    options:
      cache: false

  lint.js:
    command: 'eslint --cache apps packages --ext .js,.ts,.tsx'
    env:
      NODE_OPTIONS: '--max-old-space-size=16384'
    options:
      cache: false

  lint.json:
    command: 'prettier --write .github/**/*.yml **/tsconfig.json **/tsconfig.*.json pnpm-workspace.yaml .moon/*.yml **/moon.yml'
    options:
      cache: false

  lint.package:
    command: 'prettier --write **/package.json'
    options:
      cache: false

  test.packages:
    command: echo "✓ All packages tested"
    deps:
      - body:test
      - button:test
      - column:test
      - container:test
      - font:test
      - head:test
      - heading:test
      - hr:test
      - html:test
      - img:test
      - link:test
      - markdown:test
      - preview:test
      - row:test
      - section:test
      - tailwind:test
      - text:test
      - render:test
      # TODO: add cli test
      # - cli:test
    options:
      cache: false
      outputStyle: 'stream'
      runDepsInParallel: false
