# https://moonrepo.dev/docs/config/tasks
$schema: 'https://moonrepo.dev/schemas/tasks.json'

fileGroups:
  configs:
    - '*.{js,json}'
  sources:
    - 'src/**/*'
  tests:
    - 'tests/**/*.test.*'

tasks:
  build:
    command: echo "Build Complete âœ“"
    deps:
      - ~:clean.dist
      - ~:compile
    inputs:
      - src
      - package.json
    options:
      cache: false
      outputStyle: 'stream'
      runDepsInParallel: false
    outputs:
      - dist

  clean.dist:
    # Note: Use rimraf so PowerShell matches Linux delete behavior
    command: rimraf dist
    inputs:
      - src
      - package.json

  compile:
    command: tsc --project tsconfig.json
    inputs:
      - src
      - package.json
    options:
      runDepsInParallel: false
    outputs:
      - dist

  release:
    command: versioner --target $projectRoot
    deps:
      - ~:build
    options:
      cache: false
      outputStyle: 'stream'
      runDepsInParallel: false
