# https://moonrepo.dev/docs/config/tasks
$schema: 'https://moonrepo.dev/schemas/tasks.json'

fileGroups:
  configs:
    - '*.{js,json}'
  sources:
    - 'src/**/*'
  tests:
    - 'tests/**/*.test.*'

tasks:
  build:
    command: echo "Build Complete âœ“"
    deps:
      - ~:clean.dist
      - ~:compile
    inputs:
      - src
      - package.json
    options:
      cache: false
      outputStyle: 'stream'
      runDepsInParallel: false
    outputs:
      - dist

  clean.dist:
    # Note: Use rimraf so PowerShell matches Linux delete behavior
    command: rimraf dist
    inputs:
      - src
      - package.json

  compile:
    command: tshy
    inputs:
      - src
      - package.json
    options:
      runDepsInParallel: false
    outputs:
      - dist

  release:
    command: |
      versioner --target $projectRoot --publish=false
      rm -rf /tmp/jsx-email-pack
      mkdir -p /tmp/jsx-email-pack
      cd $projectRoot
      pnpm pack --pack-destination /tmp/jsx-email-pack
      npm publish /tmp/jsx-email-pack/*.tgz
    deps:
      - ~:build
    options:
      cache: false
      outputStyle: 'stream'
      runDepsInParallel: false
